package noiseychannel;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Scanner;

import soundex.Soundex;
import util.Tokenizer;

public class NoiseyChannel {
	
	private final String url = "query_logs.txt";
	
	private Tokenizer tokenizer;
	
	private QueryLogWords queryLogWords;
	private IncorrectQueryLogWords incorrectQueryLogWords;
	
	private Soundex soundex;
	
	public NoiseyChannel(Tokenizer _tokenizer, Soundex _soundex){
		this.tokenizer = _tokenizer;
		this.queryLogWords = new QueryLogWords();
		this.soundex = _soundex;
		this.incorrectQueryLogWords = new IncorrectQueryLogWords();
	}
	
	public void setup(){
		File file = new File(url);
		try {
			BufferedReader reader = new BufferedReader(new FileReader(file));
			String line;
			while ((line = reader.readLine()) != null){
				String[] queryLogSession = line.split("\t");
				String sessionId = queryLogSession[0];
				String queryLog = queryLogSession[1];
				
				this.examineQueryLog(sessionId, queryLog);
			}
		} 
		catch (FileNotFoundException e) {
			e.printStackTrace();
		}
		catch(IOException e){
			e.printStackTrace();
		}
	}
	
	private void examineQueryLog(String sessionId, String queryLog){
		
		Scanner reader = new Scanner(queryLog);
		
		while(reader.hasNext()){
			String word = reader.next();
			word = word.toLowerCase();
			word = word.replaceAll("[^A-Za-z0-9]", "");
			
			if
			
		}
	}
	
	public String getSuggestedCorrection(String e, ArrayList<String> S){
		// W*
		String suggestedCorrection = "";
		
		// score
		double score = 0.0;
		
		for(String W : S){
			double newScore = this.getPofEinW(e, W) * this.getPofW(W);
			if(newScore > score){
				score = newScore;
				suggestedCorrection = W;
			}
		}
		
		return suggestedCorrection;
	}
	
	private double getPofEinW(String e, String W){
		return 0.0;
	}
	
	private double getPofW(String W){
		return 0.0;
	}
}
